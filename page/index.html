<html>
	<head>
		<link rel="stylesheet" href="style.css">
		<script type="module">
			import { convert, clear_conversion } from "./convert.js";
			import { selectTab, populate_select, did_select, get_selected_id, add_row, remove_row } from "./elements.js";
			import { if_valid, get_custom, customize, clear_custom } from "./custom.js"
			import { system_with_id } from "./state.js"
			import { export_system, import_system } from "./transport.js"

			globalThis.selectTab = selectTab

			globalThis.did_select = did_select
			globalThis.get_selected_id = get_selected_id
			globalThis.system_with_id = system_with_id
			globalThis.if_valid = if_valid
			globalThis.customize = customize
			globalThis.get_custom = get_custom
			globalThis.clear_custom = clear_custom
			globalThis.export_system = export_system
			globalThis.import_system = import_system
			globalThis.convert = convert
			globalThis.clear_conversion = clear_conversion

			globalThis.add_row = add_row
			globalThis.remove_row = remove_row

			populate_select("system_select")
		</script>
	</head>
	<body>
		<div id="column" class="column">
			<div class="tab-bar">
			  <button class="tab-button active" id="presetsButton" onclick="selectTab(event, 'presets', true)">Presets</button>
			  <button class="tab-button" id="customButton" onclick="selectTab(event, 'custom', true)">Custom</button>
			  <button class="tab-button" id="aboutButton" onclick="selectTab(event, 'about', false)">About</button>
			</div>
			<div id="presets" class="tab-content">
				<select id="system_select" style="width: 200px;" onchange="did_select(system_with_id(get_selected_id('system_select')))"></select>
				<button id="customize" onclick="customize(system_with_id(get_selected_id('system_select'))); selectTab(event, 'custom', true)">customize</button>
				<p id="preset-description"></p>
				<div class="divider"></div>
				<div class="button-row">
					<button id="convert" onclick="convert(system_with_id(get_selected_id('system_select')), 'presets-conversion')">convert</button>
					<button id="clear" onclick="clear_conversion('presets-conversion')">clear</button>
				</div>
				<div id="presets-conversion" class="conversion">
					<div class="conversion-table">
						<textarea class="conversion-input" placeholder="Enter text here..."></textarea>
						<div class="conversion-output-container">
							<p class="conversion-output"></p>
							<p class="conversion-output-placeholder">...and conversion will appear here</p>
						</div>
					</div>
				</div>
			</div>
			<div id="custom" class="tab-content" style="display: none">
				<div class="button-row">
					<button onclick="import_system()">import</button>
					<button onclick="export_system(get_custom())">export</button>
					<button onclick="clear_custom()">clear</button>
				</div>
				<input type="text" id="system-name" placeholder="System Name"><br>
				<textarea id="system-description" placeholder="System description"></textarea>
				<!-- Custom graphs -->
				<div class="label-group">
					<span class="label">sounds</span>
					<div class="question-circle">
						<span class="question-mark">?</span>
						<span class="tooltip">The sound made by the highlighted letters in the example words will be represented by the characters you enter here.</span>
					</div>
				</div>
				<table class=graphTable>
					<tr>
						<td><input id="ae" type="text" class="graph">tr<u>a</u>p</td>
						<td><input id="aa" type="text" class="graph">p<u>a</u>lm</td>
						<td><input id="ei" type="text" class="graph">f<u>a</u>ce</td>
						<td><input id="schwa" type="text" class="graph">comm<u>a</u></td>
						<td><input id="b" type="text" class="graph"><u>b</u>are</td>
						<td><input id="ng" type="text" class="graph">ha<u>ng</u></td>
						<td><input id="k" type="text" class="graph"><u>k</u>iss</td>
						<td><input id="h" type="text" class="graph"><u>h</u>arp</td>
					</tr>
					<tr>
						<td><input id="e" type="text" class="graph">dr<u>e</u>ss</td>
						<td><input id="aw" type="text" class="graph">th<u>ou</u>ght</td>
						<td><input id="ai" type="text" class="graph">pr<u>i</u>ce</td>
						<td><input id="schwar" type="text" class="graph">lett<u>er</u></td>
						<td><input id="ch" type="text" class="graph"><u>ch</u>eer</td>
						<td><input id="p" type="text" class="graph"><u>p</u>eel</td>
						<td><input id="l" type="text" class="graph"><u>l</u>ook</td>
						<td><input id="j" type="text" class="graph"><u>j</u>ust</td>
					</tr>
					<tr>
						<td><input id="ih" type="text" class="graph">k<u>i</u>t</td>
						<td><input id="oo" type="text" class="graph">g<u>oo</u>se</td>
						<td><input id="oi" type="text" class="graph">ch<u>oi</u>ce</td>
						<td></td>
						<td><input id="d" type="text" class="graph"><u>d</u>usk</td>
						<td><input id="r" type="text" class="graph"><u>r</u>oad</td>
						<td><input id="m" type="text" class="graph"><u>m</u>ean</td>
						<td><input id="th" type="text" class="graph"><u>th</u>igh</td>
					</tr>
					<tr>
						<td><input id="uh" type="text" class="graph">str<u>u</u>t</td>
						<td><input id="ee" type="text" class="graph">fl<u>ee</u>ce</td>
						<td><input id="oa" type="text" class="graph">g<u>oa</u>t</td>
						<td></td>
						<td><input id="dh" type="text" class="graph"><u>th</u>ese</td>
						<td><input id="s" type="text" class="graph"><u>s</u>ee</td>
						<td><input id="n" type="text" class="graph"><u>n</u>ear</td>
						<td><input id="v" type="text" class="graph"><u>v</u>ine</td>
					</tr>
					<tr>
						<td><input id="er" type="text" class="graph">n<u>ur</u>se</td>
						<td></td>
						<td><input id="au" type="text" class="graph">m<u>ou</u>th</td>
						<td></td>
						<td><input id="f" type="text" class="graph"><u>f</u>ine</td>
						<td><input id="sh" type="text" class="graph"><u>sh</u>oe</td>
						<td><input id="w" type="text" class="graph"><u>w</u>eak</td>
						<td><input id="z" type="text" class="graph"><u>z</u>oo</td>
					</tr>
					<tr>
						<td><input id="horseshoe" type="text" class="graph">f<u>oo</u>t</td>
						<td></td>
						<td></td>
						<td></td>
						<td><input id="g" type="text" class="graph"><u>g</u>o</td>
						<td><input id="t" type="text" class="graph"><u>t</u>urn</td>
						<td><input id="y" type="text" class="graph"><u>y</u>ear</td>
						<td><input id="zh" type="text" class="graph">bei<u>ge</u></td>
					</tr>
				</table>
				<!-- Exception -->
				<div class="label-group">
					<span class="label">exceptions</span>
				</div>
				<div class="addable-row">
					<div class="row-addable" id="ligature-container">
						<div class="ligature-pair" id="template" style="display: none;">
							<input class="ligature-field" id="target" type="text">
							 &#8594; 
							<input class="ligature-field" id="value" type="text">
							<button class="x-remove" onclick="remove_row(this, 'ligature-container')"></button>
						</div>
						<button class="add-row" onclick="add_row('ligature-container')">+ ligature</button>
						<div class="question-circle">
							<span class="question-mark">?</span>
							<span class="tooltip">Replaces any instance of one sequence of characters with another.</span>
						</div>
					</div>
					<div class="row-addable" id="exception-container">
						<div class="exception-pair" id="template" style="display: none;">
							<input class="exception-field" id="target" type="text">
							 &#8594; 
							<input class="exception-field" id="value" type="text">
							<button class="x-remove" onclick="remove_row(this, 'exception-container')"></button>
						</div>
						<button class="add-row" onclick="add_row('exception-container')">+ word exception</button>
						<div class="question-circle">
							<span class="question-mark">?</span>
							<span class="tooltip">Converts a specific word to the form given here, instead of by sound.</span>
						</div>
					</div>
				</div>
				<!-- Custom options -->
				<div class="label-group">
					<span class="label">options</span>
				</div>
				<table class="optionTable">
					<tr>
						<td>
						  <input type="checkbox" id="option-capitalization">
						  <label for="option-capitalization"> Preserve capitalization</label>
							<div class="question-circle">
								<span class="question-mark">?</span>
								<span class="tooltip">Attempts to match the capitalization pattern of the input text when converting words. <br><br>Note that characters outside of the Latin alphabet may not have valid capitalized forms.</span>
							</div>
						</td>
					</tr>
				</table>
				<div class="divider"></div>
				<div class="button-row">
					<button id="convert" onclick="convert(system_with_id(get_selected_id('system_select')), 'custom-conversion')">convert</button>
					<button id="clear" onclick="clear_conversion('custom-conversion')">clear</button>
				</div>
				<div id="custom-conversion" class="conversion">
					<div class="conversion-table">
						<textarea class="conversion-input" placeholder="Enter text here..."></textarea>
						<div class="conversion-output-container">
							<p class="conversion-output"></p>
							<p class="conversion-output-placeholder">...and conversion will appear here</p>
						</div>
					</div>
				</div>
			</div>
			<div id="about" class="tab-content" style="display: none">
				<p>
					This is a tool for developing systems of spelling for the English language.
					Based on the sounds of the words, you can describe a system that will determine how they should be spelled. You can then convert texts from the usual spelling to your own.
				</p>
				<p>
					Some notes on its functioning:
					<ul>
						<li>Pronunciations come from The CMU Prouncing Dictionary, and so are based on a version of the General American accent.</li>
						<li>Where words are spelled the same but pronounced differently, such as 'tear' (crying) and 'tear' (ripping), one pronunciation is chosen arbitrarily.</li>
					</ul>
				</p>
				<p>
					The full source code is available <a href="https://github.com/inthescales/reformer">here</a>.
				</p>
				<p>
					I hope you will enjoy using it.
				</p>
				<p>
					&ndash; Robin
				</p>
			</div>
		</div>
	</body>
</html>